{% extends 'TooBigAppBundle::page-with-header.html.twig' %}
{% block javascripts %}

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    {% javascripts
    '@IphpCoreBundle/Resources/public/js/jquery.min.js'
    '@IphpCoreBundle/Resources/public/js/jquery-ui.js'
    '@IphpCoreBundle/Resources/public/js/jquery-ui-i18n.js'
    '@TooBigAppBundle/Resources/public/js/Item.js'
    '@IphpCoreBundle/Resources/public/bootstrap/3.3/js/bootstrap.min.js'
    '@TooBigAppBundle/Resources/public/js/jquery-1.6.4.js'
    '@TooBigAppBundle/Resources/public/js/jquery.jqzoom-core.js' %}
    <script src="{{ asset_url }}"></script>
    {% endjavascripts %}

    <script type="application/javascript">
        $(document).ready(function() {
            $('.jqzoom').jqzoom({
                zoomType: 'standard',
                lens:true,
                preloadImages: false,
                alwaysOn:false
            });
        });
    </script>

{% endblock javascripts %}

{% block stylesheets %}
    {{ parent() }}
    <link href="/bundles/toobigapp/css/jqzoom.css" rel="stylesheet">
{% endblock stylesheets %}


{% block page_header %}
{% if content %}
<div class="page-header">
    <h1>{{ content }}
        <small>{{ content.abstract}}</small>
    </h1>
    <a class="btn btn-success" href="{{ path('app_item_add', {'rubric_id': content.rubric.id}) }}">Добавить объявление</a> в раздел "<a href="{{ entitypath(content.rubric.parent) }}">{{ content.rubric.parent }}</a> > <a href="{{ entitypath(content.rubric) }}">{{ content.rubric.title }}</a>"
    или <a class="btn btn-success" href="{{ path('app_item_edit', {'item_id': content.id}) }}">Редакировать это объявление</a>

    {% for flashMessage in app.session.flashbag.get('notice') %}

        {{ flashMessage | raw }}

    {% endfor %}

</div>
{% else %}
{{ parent() }}
{% endif%}
{% endblock page_header %}





{% block page_body %}
{% if content %}


{# block content_image %}
{% if content.image %}
    <a href="{{ content.image.path }}" target="_blank"><img src="{{ content.image.path }}" class="img-polaroid"></a>
{% endif %}
{% endblock #}

<div class="item-group">
    <div class="col-sm-4">
        {% block content_images  %}

            {%  if content.imagesMedia | length %}

                <div class="shopitem-img-div">
                    <div class="clearfix">
                        <a class="jqzoom" rel='gal1' title="triumph" href="{% path content.imagesMedia[0].media, 'reference' %}" rel="{{ content.imagesMedia[0].id }}">
                            <img class="shopitem-img-main" src="{% path content.imagesMedia[0].media, 'preview' %}"/>
                        </a>
                    </div>
                </div>
                <div class="shopitem-img-list-div">
                    <ul id="thumblist" class="clearfix">
                        {% for image in content.imagesMedia  if image.media %}
                            <li>
                                <a href="javascript:void(0);" rel="{gallery: 'gal1', smallimage: '{% path image.media, 'preview' %}',largeimage: '{% path image.media, 'reference' %}'}">
                                    <img border="0" src="{% path image.media, 'small' %}"/>
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>

            {% endif %}

            {%  if files | length %}

                <div class="shopitem-img-div">
                    <div class="clearfix">
                        <a class="jqzoom" rel='gal1' title="triumph" href="/uploads/attachments/{{ content.id }}/originals/{{ files[0] }}" rel="{{ files[0] }}">
                            <img class="shopitem-img-main" src="/uploads/attachments/{{ content.id }}/small/{{ files[0] }}"/>
                        </a>
                    </div>
                </div>
                <div class="shopitem-img-list-div">
                    <ul id="thumblist" class="clearfix">
                        {% for file in files %}
                            <li>
                                <a href="javascript:void(0);" rel="{gallery: 'gal1', smallimage: '/uploads/attachments/{{ content.id }}/small/{{ file }}',largeimage: '/uploads/attachments/{{ content.id }}/originals/{{ file }}'}">
                                    <img border="0" src="/uploads/attachments/{{ content.id }}/thumbnails/{{ file }}"/>
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>

            {% endif %}

        {% endblock content_images %}

        {% if watch_item is defined %}
            {% block watch_item %}
                {% if watch_item.id is defined %}
                    <a class="btn btn-warning" id="app_watch_item" path-controller="{{ path('app_item_unwatch', {'item_id': content.id}) }}">Отписаться от обновлений</a>
                {% else %}
                    <a class="btn btn-warning" id="app_watch_item" path-controller="{{ path('app_item_watch', {'item_id': content.id}) }}">Подписаться на обновления</a>
                {% endif %}
            {% endblock watch_item %}
        {% endif %}

    </div>
    <div class="col-sm-8">
        {% block content_content %}
            {{ content.content|raw}}

            {% block content_price %}
                {% if content.price %}
                    <p>{{ content.price }} рублей.</p>
                {% endif %}
            {% endblock content_price %}

            {% block content_author %}
                {% if content.createdBy %}
                    <p>Продавец {{ content.createdBy }}</p>
                {% endif %}
            {% endblock content_author %}

            {% block content_rate %}
                {% if rate | length %}
                    <p>Рейтинг: {{ rate[0].avg_rate | number_format(2, '.', ',') }} из 5</p>
                {% endif %}
            {% endblock content_rate %}

            {% block content_comments %}
                <h4>Комментарии и оценки пользователей</h4>
                {% if comments | length %}
                    {% for comment in comments %}
                        <div>{{ comment.user }}: {{ comment.comment }}</div>
                        <div>Оценка: {{ comment.rate | number_format(2, '.', ',') }} из 5</div>
                    {% endfor %}
                {% else %}
                    Комментариев нет
                {% endif %}

                {% if rate_comment_item is defined %}
                    {% block rate_comment_item %}
                        {% if rate_comment_item.id is defined %}
                            {#<div class="app_comment_form"></div>
                            <a class="btn btn-success" id="app_comment_item" path-controller="{{ path('app_item_comment_edit', {'item_id': content.id}) }}">Редактировать комментарий</a>#}
                        {% else %}
                            <div class="app_comment_form"></div>
                            <a class="btn btn-success" id="app_comment_item" path-controller="{{ path('app_item_comment_add', {'item_id': content.id}) }}">Добавить комментарий</a>
                        {% endif %}
                    {% endblock rate_comment_item %}
                {% endif %}

            {% endblock content_comments %}

        {% endblock content_content %}

        {% if content.links | length %}
            {% block content_links %}
                <h3>Ссылки</h3>

                <ul>
                    {% for link in content.links %}
                        {% block content_link %}
                            <li><a target="_blank" href="{{ link.url }}">{{ link.title}}</a></li>
                        {% endblock content_link %}
                    {% endfor %}
                </ul>
            {% endblock content_links %}
        {% endif %}

        {# if content.publishedFiles| length %}
        {% block content_files %}
         <h3>Файлы</h3>

         <ul>
             {% for file in content.publishedFiles %}
             {% block content_file %}
             <li><a target="_blank" href="{{ file.file.path }}">{{ file }}</a></li>
             {% endblock content_file %}
             {% endfor %}
         </ul>
        {% endblock content_files %}
        {% endif #}
    </div>
</div>

{% endif %}
{% endblock page_body %}

